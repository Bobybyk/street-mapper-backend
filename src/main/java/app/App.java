/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package app;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;
import app.map.PlanParser;
import app.map.PlanParser.InconsistentDataException;
import app.server.Server;
import app.util.Logger;
import app.util.Logger.Type;

public class App {

    public static final int PORT = 12345;

    /**
     * Commentaire d'erreur en static pour la gestion de fichier
     */
    private final static String errorIllegalArgument =
            "Arguments invalides. Arguments Attendus : java App <file>";
    private final static String errorFileNotExist =
            "Fichier introuvable ou est un repertoire";
    private final static String errorIncorrectFile = "Le fichier est incorrect ";
    private final static String errorServeurStart = "Le serveur n'a pas demarr√©";
    
    public static void main(String[] args) {
        if (!argsIsOk(args)) {
            Logger.logln(Type.ERROR, errorIllegalArgument);
            return;
        }

        final File mapFile = new File(args[0]);
        if (!isCVSFileOk(mapFile)) {
            Logger.logln(Type.ERROR, errorFileNotExist);
            return;
        }
        
        try {                
            final Server server = new Server(mapFile.getPath(), PORT, true);    
            if (hasCsvTimeFile(args)) {
                server.updateTime((new File(args[1]).getPath()));;
            }
            
            server.start();
        } catch (FileNotFoundException e) {
            Logger.logln(Type.ERROR, errorFileNotExist);;
        } catch (PlanParser.IncorrectFileFormatException e) {
            Logger.logln(Type.ERROR, errorIncorrectFile);
        } catch (IOException e) {
            Logger.logln(Type.ERROR, errorServeurStart);
        } catch (InconsistentDataException e) {
            Logger.logln(Type.ERROR, e.getMessage());
        }  
    }

    /**
     * Cette fonction renvoie un vrai si les arguments sont correctes s'ils respectent le formatage
     * ou faux si les arguments ne respectent pas le formatage
     *
     * @param args l'ensemble des arguments
     * @return boolean
     */
    public static boolean argsIsOk(String[] args) {
        return !(args.length < 1 || args.length > 4);
    }

    public static boolean hasCsvTimeFile(String[] args) {
        return args.length == 3;
    }

    private static boolean isCVSFileOk(File mapFile) {
        return mapFile.exists() && !mapFile.isDirectory();
    }
}
